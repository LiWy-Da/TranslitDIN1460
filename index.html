<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Transliterationstool</title>

<style>
body {
  font-family: sans-serif;
  max-width: 950px;
  margin: 2rem auto;
}

.flex-row {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

select, button {
  margin: 0.3rem 0.3rem 0.3rem 0;
}

.textview {
  min-height: 160px;
  padding: 0.5rem;
  border: 1px solid #ccc;
  white-space: pre-wrap;
  font-family: inherit;
  overflow-wrap: break-word;
}

.ambig {
  background: #fff3a0;
  font-weight: bold;
}

.hint {
  font-size: 0.9rem;
  color: #555;
}

label {
  font-weight: bold;
}
</style>
</head>

<body>

<h1>Transliterationstool</h1>

<div class="flex-row">
  <div>
    <label>Sprache:</label><br>
    <select id="lang">
      <option value="ru">Russisch</option>
    </select>
  </div>

  <div>
    <label>Transliterationssystem:</label><br>
    <select id="systemFrom">
      <option value="DIN">DIN 1460</option>
      <option value="ALA">ALA-LC</option>
      <option value="BL">British Library</option>
      <option value="BNF">BnF</option>
    </select>
  </div>

  <div>
    <label>Ausgabe Umtransliteration:</label><br>
    <select id="systemTo">
      <option value="DIN">DIN 1460</option>
      <option value="ALA">ALA-LC</option>
      <option value="BL">British Library</option>
      <option value="BNF">BnF</option>
    </select>
  </div>
</div>

<h3>Eingabe</h3>
<div id="inputView" class="textview" contenteditable></div>
<textarea id="input" hidden></textarea>

<div class="flex-row">
  <button onclick="doTransliteration()">Transliterieren</button>
  <button onclick="doReverse()">Rücktransliteration</button>
  <button onclick="doUmtransliteration()">Umtransliteration</button>
</div>

<h3>Ausgabe</h3>
<div id="outputView" class="textview"></div>
<textarea id="output" hidden></textarea>

<button onclick="copyOutput()">Copy</button>

<p class="hint">
⚠️ Gelb markierte Stellen sind mehrdeutig und können ohne Kontext
nicht eindeutig (rück-/um-)transliteriert werden.
</p>

<script>
// =========================
// TRANSLITERATIONSSYSTEME FÜR RUSSISCH
// =========================

const systems = {
  DIN: {
    ru: {
      "А":"A","а":"a","Б":"B","б":"b","В":"V","в":"v","Г":"G","г":"g",
      "Д":"D","д":"d","Е":"E","е":"e","Ё":"Ë","ё":"ë","Ж":"Ž","ж":"ž",
      "З":"Z","з":"z","И":"I","и":"i","Й":"J","й":"j","К":"K","к":"k",
      "Л":"L","л":"l","М":"M","м":"m","Н":"N","н":"n","О":"O","о",
      "П":"P","п":"p","Р":"R","р":"r","С":"S","с":"s","Т":"T","т":"t",
      "У":"U","у":"u","Ф":"F","ф":"f","Х":"Ch","х":"ch","Ц":"C","ц":"c",
      "Ч":"Č","ч":"č","Ш":"Š","ш":"š","Щ":"Šč","щ":"šč",
      "Ы":"Y","ы":"y","Э":"È","э":"è","Ю":"Ju","ю":"ju","Я":"Ja","я":"ja"
    }
  },
  ALA: {
    ru: {
      "А":"A","а":"a","Б":"B","б":"b","В":"V","в":"v","Г":"G","г":"g",
      "Д":"D","д":"d","Е":"E","е":"e","Ё":"Ë","ё":"ë","Ж":"Zh","ж":"zh",
      "З":"Z","з":"z","И":"I","и":"i","Й":"Ĭ","й":"ĭ","К":"K","к":"k",
      "Л":"L","л":"l","М":"M","м":"m","Н":"N","н":"n","О":"O","о",
      "П":"P","п":"p","Р":"R","р":"r","С":"S","с":"s","Т":"T","т":"t",
      "У":"U","у":"u","Ф":"F","ф":"f","Х":"Kh","х":"kh","Ц":"Ts","ц":"ts",
      "Ч":"Ch","ч":"ch","Ш":"Sh","ш":"sh","Щ":"Shch","щ":"shch",
      "Ы":"Y","ы":"y","Э":"E","э":"e","Ю":"I͡u","ю":"i͡u","Я":"I͡a","я":"i͡a"
    }
  },
  BL: {
    ru: {
      "А":"A","а":"a","Б":"B","б":"b","В":"V","в":"v","Г":"G","г":"g",
      "Д":"D","д":"d","Е":"E","е":"e","Ё":"Yo","ё":"yo","Ж":"Zh","ж":"zh",
      "З":"Z","з":"z","И":"I","и":"i","Й":"Y","й":"y","К":"K","к":"k",
      "Л":"L","л":"l","М":"M","м":"m","Н":"N","н":"n","О":"O","о",
      "П":"P","п":"p","Р":"R","р":"r","С":"S","с":"s","Т":"T","т","У":"U","у":"u",
      "Ф":"F","ф":"f","Х":"Kh","х":"kh","Ц":"Ts","ц":"ts","Ч":"Ch","ч":"ch",
      "Ш":"Sh","ш":"sh","Щ":"Shch","щ":"shch",
      "Ы":"Y","ы":"y","Э":"E","э":"e","Ю":"Yu","ю":"yu","Я":"Ya","я":"ya"
    }
  },
  BNF: {
    ru: {
      "А":"A","а":"a","Б":"B","б":"b","В":"V","в":"v","Г":"G","г":"g",
      "Д":"D","д":"d","Е":"E","е":"e","Ё":"Ë","ё":"ë","Ж":"Ž","ж":"ž",
      "З":"Z","з":"z","И":"I","и":"i","Й":"Ĭ","й":"ĭ","К":"K","к":"k",
      "Л":"L","л":"l","М":"M","м":"m","Н":"N","н","О":"O","о",
      "П":"P","п":"p","Р":"R","р":"r","С":"S","с":"s","Т":"T","т","У":"U","у":"u",
      "Ф":"F","ф":"f","Х":"Kh","х":"kh","Ц":"Ts","ц":"ts","Ч":"Ch","ч":"ch",
      "Ш":"Š","ш":"š","Щ":"Št","щ":"št","Ы":"Y","ы":"y","Э":"È","э":"è",
      "Ю":"I͡u","ю":"i͡u","Я":"I͡a","я":"i͡a"
    }
  }
};

// =========================
// AMBIGUITÄTEN
// =========================

const ambiguous = {
  ru: {
    DIN: { "ch": ["Х","Ч"], "šč": ["Щ","ШЧ"], "e": ["Е","Э"], "j": ["Й","Ь"] },
    ALA: { "Kh": ["Х"], "Shch": ["Щ"], "I͡u": ["Ю"], "I͡a": ["Я"] },
    BL:  { "Kh": ["Х"], "Shch": ["Щ"], "Yu": ["Ю"], "Ya": ["Я"] },
    BNF: { "Kh": ["Х"], "Št": ["Щ"], "I͡u": ["Ю"], "I͡a": ["Я"] }
  }
};

// =========================
// HILFSFUNKTIONEN
// =========================

function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function syncInput() {
  input.value = inputView.innerText;
}

function transliterate(text, system, lang) {
  const map = systems[system][lang];
  for (let k in map) text = text.split(k).join(map[k]);
  return text;
}

function reverseTransliterate(text, system, lang) {
  const map = systems[system][lang];
  const reverse = {};
  for (let k in map) reverse[map[k]] = k;

  const keys = Object.keys(reverse).sort((a,b)=>b.length-a.length);
  for (let k of keys) text = text.split(k).join(reverse[k]);
  return text;
}

// =========================
// MARKIERUNG
// =========================

function markInputAmbiguous() {
  const lang = langSelect.value;
  const system = systemFrom.value;
  const amb = ambiguous?.[lang]?.[system];
  if (!amb) {
    inputView.innerHTML = inputView.innerText;
    return;
  }

  let text = inputView.innerText;
  const keys = Object.keys(amb).sort((a,b)=>b.length-a.length);
  for (let k of keys) {
    const re = new RegExp(escapeRegExp(k), "g");
    text = text.replace(re, `<span class="ambig">${k}</span>`);
  }
  inputView.innerHTML = text;
}

function markOutputAmbiguous(text, lang, system) {
  const amb = ambiguous?.[lang]?.[system];
  if (!amb) return text;

  const keys = Object.keys(amb).sort((a,b)=>b.length-a.length);

  for (let k of keys) {
    const latinEquivs = amb[k].map(cyr => systems[system][lang][cyr]).filter(Boolean);
    latinEquivs.forEach(lat => {
      const re = new RegExp(escapeRegExp(lat), "g");
      text = text.replace(re, `<span class="ambig">${lat}</span>`);
    });
  }
  return text;
}

// =========================
// BUTTON / AKTIONEN
// =========================

function doTransliteration() {
  syncInput();
  const lang = langSelect.value;
  const system = systemFrom.value;
  let result = transliterate(input.value, system, lang);
  outputView.innerHTML = markOutputAmbiguous(result, lang, system);
  output.value = result;
}

function doReverse() {
  syncInput();
  const lang = langSelect.value;
  const system = systemFrom.value;
  let result = reverseTransliterate(input.value, system, lang);
  outputView.innerHTML = markOutputAmbiguous(result, lang, system);
  output.value = result;
}

function doUmtransliteration() {
  syncInput();
  const lang = langSelect.value;
  const from = systemFrom.value;
  const to = systemTo.value;

  let kyr = reverseTransliterate(input.value, from, lang);
  let result = transliterate(kyr, to, lang);

  outputView.innerHTML = markOutputAmbiguous(result, lang, to);
  output.value = result;
}

function copyOutput() {
  navigator.clipboard.writeText(output.value);
}

// =========================
// ELEMENTREFERENZEN & LIVE-UPDATES
// =========================

const inputView = document.getElementById("inputView");
const outputView = document.getElementById("outputView");
const input = document.getElementById("input");
const output = document.getElementById("output");
const langSelect = document.getElementById("lang");
const systemFrom = document.getElementById("systemFrom");
const systemTo = document.getElementById("systemTo");

inputView.addEventListener("input", () => {
  syncInput();
  markInputAmbiguous();
  doTransliteration();
});
</script>

</body>
</html>
